<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Verbena site</title>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

    <style type="text/css">
      html {
        font-family: Roboto, 'Helvetica Neue', sans-serif;
        height: 100%;
        line-height: 1.5;
      }
      body {
        height: 100%;
        margin: 0;
        -webkit-text-size-adjust: 100% !important; -ms-text-size-adjust: 100% !important; -webkit-font-smoothing: antialiased !important;
      }
      [al-it-cen] { align-items: center; }
      [bg-sz-cov] { background-size: cover; }
      [bx-sz-brd] { box-sizing: border-box; }
      [ds-fl] { display: flex; }
      [fn-sz-inh] { font-size: inherit; }
      [fn-sz-2] { font-size: calc(100% - 2px); }
      [fn-sz\+2] { font-size: calc(100% + 2px); }
      [fn-st-italic] { font-style: italic; }
      [fn-wg-bold] { font-weight: bold; }
      [fl-dr-col] { flex-direction: column; }
      [hg-100] { height: 100%; }
      [js-cn-cen] { justify-content: center; }
      [js-cn-bet] { justify-content: space-between; }
      [mr-bt-05] { margin-bottom: 0.5em; }
      [mr-lf-05] { margin-left: 0.5em; }
      [mr-rg-05] { margin-right: 0.5em; }
      [mr-tp-05] { margin-top: 0.5em; }
      [pd-lf-05] { padding-left: 0.5em; }
      [pd-rg-05] { padding-right: 0.5em; }
      [ps-rel] { position: relative; }
      [ps-abs] { position: absolute; }
      [tx-al-cen] { text-align: center; }
      [wd-100] { width: 100%; }
      [us-nn] { user-select: none; }
    </style>
  </head>
  <body>

    <style>
      @media (width <= 480px) {
        .s-desktop { --a-hd-hg: min(18vh, 80px); }
        .s-content { --pd: 0.5em; --wd: 100%; }
      }
      @media (480px < width <= 768px) {
        .s-desktop { --a-hd-hg: 74px; }
        .s-content { --pd: 1.5em; --wd: 30em; }
      }
      @media (768px < width <= 1024px) {
        .s-desktop { --a-hd-hg: 68px; }
        .s-content { --pd: 2em; --wd: 32em; }
      }
      @media (1024px < width <= 1280px) {
        .s-desktop { --a-hd-hg: 64px; }
        .s-content { --pd: 2.5em; --wd: 34em; }
      }
      @media (1280px < width) {
        .s-desktop { --a-hd-hg: 62px; }
        .s-content { --pd: 3em; --wd: 36em; }
      }
      .s-desktop {
        --a-site-unauth: hsl(55, 80%, 88%);
        --a-hd-bg: var(--a-site-unauth);
        --a-ft-hg: 1.75em;
        --a-ft-bg: var(--a-site-unauth);
      }
      header { background-color: var(--a-hd-bg); border-bottom: 1px solid lightgrey; flex: 0 0 var(--a-hd-hg); }
      footer { background-color: var(--a-ft-bg); border-top: 1px solid lightgrey; flex: 0 0 var(--a-ft-hg); }
      main { flex: 1 1 auto; height: fit-content; }

      .hd-panel { padding: 0 1em; }
      .hd-logo-mini {
        background-image: url("assets/images/logo-bin.svg");
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        height: 3.5em;
        width: 3.5em;
      }
      
      .s-logo-text { font-size: 1.125rem; font-weight: bold; }

      .s-content {
        background-color: honeydew;
        border-color: rgb(228, 243, 228);
        border-style: solid;
        border-radius: var(--pd);
        border-width: 2px;
        box-shadow: rgba(0, 0, 0, 0.35) 0px 4px 11px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        margin: auto;
        min-height: 10vh;
        padding: calc(var(--pd) / 2) var(--pd);
        width: var(--wd);
      }
      .s-title {
        font-size: calc(100% + 6px);
        font-weight: bold;
        text-align: center;
      }

      .s-hint-wrap { margin-left: 1em; min-height: 2.111em; }
      .s-hint { line-height: 1.2; font-size: calc(0.75rem + 1px); }
      .s-hint:not(.s-err) { color: hsl(210, 8%, 35%); }
      .s-err { color: rgb(224,32,32); }

      .s-footer {
        height: 100%;
        line-height: 1;
        padding-left: 0.8em;
      }
    </style>

    <div ds-fl fl-dr-col hg-100 class="s-desktop">
      <header ds-fl js-cn-bet bx-sz-brd>
        <div ds-fl al-it-cen class="hd-panel">
          <i bg-sz-cov class="hd-logo-mini"></i>
          <span mr-lf-05 id="app_name_id1" class="s-logo-text"></span>
        </div>
      </header>

      <main>
        <div ds-fl fl-dr-col js-cn-cen al-it-cen hg-100>
            <div us-nn id="content_id" class="s-content">
              
              <div class="s-title" id="title_id"></div>

              <span mr-tp-05 id="start_id">
                <span id="label_id"></span>  
                <p id="text_id"></p>
              </span>
  
            </div>
          </div>
      </main>

      <footer ds-fl al-it-cen bx-sz-brd class="s-footer">
        <a href="/ind/about" id="app_name_id2"></a>&nbsp;<span id="app_demo_site_id"></span>
      </footer>
    </div>

    <template id="tmp_success_id">
      <span id="succ_answ_id"></span>
      <p><a href="/ind/login" id="link_login_id"></a></p>
    </template>
  
    <template id="tmp_failure_id">
      <div mr-bt-05 mr-tp-05 id="fail_answ_id"></div>
      <div mr-bt-05 mr-tp-05 fn-sz-2 fn-st-italic id="err_msg_id" class="s-err"></div>
      <a href="/ind/signup" id="link_signup_id"></a>
    </template>
  
    <script type="text/javascript" language="javascript">

      function getTranslate(code, msg) {
        return !!translate[code] ? (translate[code][msg] || "") : "";
      }

      function httpClient(method, apiUrl, callbackSuccess, callbackFailure, recoveryData) {
        const xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (xhr.readyState != xhr.DONE) {
            return;
          }
          if (200 <= xhr.status && xhr.status < 209) {
            callbackSuccess(xhr.responseText);
          } else {
            callbackFailure(xhr.responseText, xhr.status);
          }
        };

        xhr.open(method || "GET", apiUrl, true); // true for asynchronous
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(!!recoveryData ? JSON.stringify(recoveryData) : null);
      }

      // ** Start of the program **
      let translate = {};

      httpClient("GET", "./assets/extra-i18n/en.json", load_extra_i18n_successful, load_extra_i18n_failed);

      function load_extra_i18n_successful(responseText) {
        translate = JSON.parse(responseText);

        prepareData();

        const urlParams = new URLSearchParams(window.location.search);
        const registr_token = urlParams.get('param')
        const url = window.location.origin + "/api/registration/" + registr_token;
        
        httpClient("PUT", url, registrationSuccessful, registrationFailed);
      }
      function load_extra_i18n_failed(responseText, status) {
        console.error(`load_extra_i18n_failed();`);
      }

      function prepareData() {
        // Header
        const app_name1 = document.getElementById("app_name_id1");
        app_name1.innerText = getTranslate("app", "name");
        // Footer
        const app_name2 = document.getElementById("app_name_id2");
        app_name2.innerText = getTranslate("app", "name");
        const app_demo_site = document.getElementById("app_demo_site_id");
        app_demo_site.innerText = getTranslate("app", "demo_site");

        const content = document.getElementById("content_id");

        const title = content.querySelector("[id=title_id]");
        title.innerText = getTranslate("Registration", "title");

        const label = content.querySelector("[id=label_id]");
        label.innerText = getTranslate("Registration", "label");

        const text = content.querySelector("[id=text_id]");
        text.innerText = getTranslate("Registration", "text");
      }

      function registrationSuccessful(responseText) {
        const content = document.getElementById("content_id");
        const tmpl = document.getElementById("tmp_success_id");

        const clon = tmpl?.content.cloneNode(true);
        const succ_answer = clon.querySelector("[id=succ_answ_id]");
        succ_answer.innerText = getTranslate("Registration", "confirm_successful");

        const link_login = clon.querySelector("[id=link_login_id]");
        link_login.innerText = getTranslate("Registration", "link_login");

        content?.appendChild(clon);

        const start = content.querySelector("[id=start_id]");
        start?.parentElement.removeChild(start);
      }

      function registrationFailed(responseText, status) {
        const content = document.getElementById("content_id");
        const tmpl = document.getElementById("tmp_failure_id");
        const clon = tmpl?.content.cloneNode(true);

        const fail_answer = clon.querySelector("[id=fail_answ_id]");
        fail_answer.innerText = getTranslate("Registration", "confirm_failed");

        const errText = clon.querySelector("[id=err_msg_id]");
        const err = JSON.parse(responseText);
        errText.innerText = getTranslate(err.code, err.message) || (err.code + ": " + err.message);

        const link_signup = clon.querySelector("[id=link_signup_id]");
        link_signup.innerText = getTranslate("Registration", "link_signup");

        content?.appendChild(clon);

        let start = content.querySelector("[id=start_id]");
        start?.parentElement.removeChild(start);
      }
    </script>

  </body>
</html>
