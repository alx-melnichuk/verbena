<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Verbena site</title>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />

    <style type="text/css">
      html { height: 100%; }
      body { height: 100%; line-height: 1.5; margin: 0 !important; padding: 0 !important;
        -webkit-text-size-adjust: 100% !important; -ms-text-size-adjust: 100% !important; -webkit-font-smoothing: antialiased !important;  }
      [al-it-cen] { align-items: center; }
      [bg-sz-cov] { background-size: cover; }
      [bx-sz-brd] { box-sizing: border-box; }
      [ds-fl] { display: flex; }
      [fn-sz-inh] { font-size: inherit; }
      [fn-sz-2] { font-size: calc(100% - 2px); }
      [fn-sz\+2] { font-size: calc(100% + 2px); }
      [fn-st-italic] { font-style: italic; }
      [fn-wg-bold] { font-weight: bold; }
      [fl-dr-col] { flex-direction: column; }
      [hg-100] { height: 100%; }
      [js-cn-cen] { justify-content: center; }
      [js-cn-bet] { justify-content: space-between; }
      [mr-bt-05] { margin-bottom: 0.5em; }
      [mr-lf-05] { margin-left: 0.5em; }
      [mr-rg-05] { margin-right: 0.5em; }
      [mr-tp-05] { margin-top: 0.5em; }
      [pd-lf-05] { padding-left: 0.5em; }
      [pd-rg-05] { padding-right: 0.5em; }
      [ps-rel] { position: relative; }
      [ps-abs] { position: absolute; }
      [tx-al-cen] { text-align: center; }
      [wd-100] { width: 100%; }
    </style>
  </head>
  <body>
    <!-- ==A basic_layout.hbs -->
    <!-- {{> @partial-block}} -->

    <style>
      .s-desktop {  --a-hd-hg: 4.4em; --a-hd-bg: hsl(140, 40%, 90%); --a-ft-hg: 2.3em; --a-ft-bg: hsl(140, 40%, 90%);
        font-family: sans-serif; }
      a, a:visited, a:hover { text-decoration: none; }
      header { background-color: var(--a-hd-bg); border-bottom: 1px solid lightgrey; flex: 0 0 var(--a-hd-hg); }
      footer { background-color: var(--a-ft-bg); border-top: 1px solid lightgrey; flex: 0 0 var(--a-ft-hg); }
      main { flex: 1 1 auto; height: fit-content; }

      .hd-logo-mini { height: 4em; width: 4em; background-image: url("assets/images/logo_mini.png"); }

      .s-content {
        @media screen and (max-width: 480px) { --pd: 0.5em; --wd: 100%; }
        @media screen and (min-width: 480px) and (max-width: 960px) { --pd: 1.5em; --wd: calc(16 * var(--pd)); }
        @media screen and (min-width: 960px) { --pd: 2em; --wd: calc(14 * var(--pd)); }
        background-color: honeydew;
        border-radius: var(--pd);
        box-sizing: border-box;
        margin-bottom: 7em;
        min-height: 10vh;
        padding: var(--pd);
        width: var(--wd);
      }
      .s-title {
        font-size: calc(100% + 4px);
        font-weight: bold;
      }
      .s-text { font-size: calc(100% - 2px); }

      .s-err { color: rgb(224,32,32); }
      .s-field-wrap { --wd-icon: 1.5em; margin-bottom: 0.25em; }
      .s-field:not(:focus) { --delta: 1px; border-width: 1px; }
      .s-field:disabled { color: rgba(0,0,0,0.38); caret-color: transparent; }

      .s-field { --br-cl: rgba(0,0,0,0.38); }
      .s-field:not(:disabled):not(:focus):hover { --br-cl-hov: rgba(0,0,0,0.87); }
      .s-field:focus { --br-cl-foc: rgb(63,81,181); }
      .s-field[d-touched]:invalid { --br-cl-err: rgb(244,67,54); }

      .s-field {
        border-color: var(--br-cl-err, var(--br-cl-foc, var(--br-cl-hov, var(--br-cl,unset))));
        border-radius: 0.25em;
        border-style: solid;
        height: 3em;
        outline: none;
        padding-left: calc(1em + var(--delta, 0px));
        padding-right: calc(1em + var(--delta, 0px));
      }
      .s-btn-eye { 
        background-color: transparent;
        border: none;
        cursor: pointer;
        display: flex;
        padding: 0px;
        outline: none;
        right: 0.9em;
        top: calc(50% - var(--wd-icon) / 2);
        z-index: 1;
      }
      .s-icon {  width: var(--wd-icon); height: var(--wd-icon); }
      .s-btn {
        border: none;
        border-radius: 0.25em;
        box-shadow: 0px 3px 1px -2px rgba(0,0,0,0.2), 0px 2px 2px 0px rgba(0,0,0,0.14), 0px 1px 5px 0px rgba(0,0,0,0.12);
        height: 2.25em;
        outline: none;
        transition: box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);
      }
      .s-btn:focus {
        box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2), 0px 4px 5px 0px rgba(0,0,0,0.14), 0px 1px 10px 0px rgba(0,0,0,0.12);
      }
      .s-btn:not(:disabled):active {
        box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2), 0px 8px 10px 1px rgba(0,0,0,0.14), 0px 3px 14px 2px rgba(0,0,0,0.12);
        opacity: 0.85;
      }
      .s-btn:hover {
        box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2), 0px 4px 5px 0px rgba(0,0,0,0.14), 0px 1px 10px 0px rgba(0,0,0,0.12);
      }
      .s-btn:disabled { cursor: default; pointer-events: none;
        color: rgba(0,0,0,0.38); background-color: rgba(0,0,0,0.12);
        box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.2), 0px 0px 0px 0px rgba(0,0,0,0.14), 0px 0px 0px 0px rgba(0,0,0,0.12);
      }

      .s-hint-wrap { margin-left: 1em; min-height: 2.111em; }
      .s-hint { line-height: 1.2; font-size: calc(100% - 4px); }

      .s-submit { background-color: #3f51b5; color: #fff; }

    </style>

    <div ds-fl fl-dr-col hg-100 class="s-desktop">
      <header ds-fl js-cn-bet bx-sz-brd>
        <a ds-fl al-it-cen pd-lf-05 pd-rg-05 id="hd_ref" href="/login">
          <i bg-sz-cov class="hd-logo-mini"></i>
          <span mr-lf-05 style="font-size: x-large; font-weight: 600;">Verbéna</span>
        </a>
      </header>

      <main>
        
        <div ds-fl fl-dr-col js-cn-cen al-it-cen hg-100>
          <div id="content_id" class="s-content">
            <form ds-fl fl-dr-col id="form_prm_id">

              <div mr-bt-05 tx-al-cen class="s-title">Change password</div>

              <span mr-bt-05 mr-tp-05 tx-al-cen class="s-text">Enter a new password for your account.</span>

              <div mr-tp-05 wd-100 ps-rel class="s-field-wrap">
                <input type="password" fn-sz-inh wd-100 bx-sz-brd class="s-field" placeholder="New password"
                  id="field_passwd_id" data-dirty="off" autocomplete="off"
                  required="" minlength="6" maxlength="65" 
                  onchange="doInputPassword(this, true);"
                  oninput="elementInput(this); doInputPassword(this, false);"
                  onblur="elementBlur(this)"
                  d-untouched
                  d-pristine
                />
                <button type="button" fn-sz-inh ps-abs class="s-btn-eye" title="Toggle password visibility" tabindex="-1"
                  onclick="doToggleEye(this)" id="btn_eye_id" eye-off>
                </button>
              </div>

              <div class="s-hint-wrap">
                <div class="s-hint" id="err_hint_id"></div>
              </div>

            </form>
            
            <button type="button" fn-sz-inh mr-bt-05 wd-100 
              class="s-btn s-submit" onclick="doSubmit()">
              <span fn-sz-2 fn-wg-bold>Change</span>
            </button>

          </div>
        </div>

      </main>

      <footer ds-fl al-it-cen bx-sz-brd style="padding-left: 2em;">
        <span><a id="ft_ref" href="/login" target="_blank">Verbéna</a> demo site.</span>
      </footer>
    </div>

    <!-- 
 
<form class="container" *ngIf="!!confirmationId"
  [formGroup]="formGroup"
  novalidate
>
  <p>Enter new password for Bullpit.</p>
  < !-- Введите новый пароль для Bullpit. -- >
  <div class="password">
    <app-widget-password
      formControlName="newPassword"
      [isRequired]="true"
      [label]=""New password""
    ></app-widget-password>
  </div>
  <button mat-raised-button class="smd-button submit" color="primary"
    [disabled]="formGroup.invalid || isDisabledSubmit"
    (click)="doSubmit()"
  >Submit
  </button>

  <div *ngIf="isResponseSuccessful==true">
    <p>Your password have been changed to new one!</p>
    < !--Ваш пароль изменен на новый!-- >
    <p>Please follow to <a href="/login">(login form)</a> for authorization.</p>
    < !-- Пожалуйста, перейдите по <a href="/login">(форма входа)</a> для авторизации. -- >
  </div>
  <div class="failed" *ngIf="isResponseSuccessful==false">
    <p>Your confirmation have been expired!</p>
    < !-- Срок действия вашего подтверждения истек! -- >
  </div>
</form>
    -->
    <template id="tmp_eye_off_id">
      <svg class="s-eye-off s-icon">
        <g fill="#788393">
          <path d="m12.000,5c-6.1608,0 -11.6507,6.4039 -11.8817,6.6769c-0.1580,0.186 -0.1580,0.459 0,0.646c0.138,0.163 2.1559,2.5059 5.0659,4.371l3.1339,-3.134c-0.2039,-0.48 -0.3179,-1.007 -0.3179,-1.5609c0,-2.2059 1.79397,-3.9999 3.9998,-3.9999c0.554,0 1.081,0.114 1.561,0.318l2.577,-2.5769c-1.256,-0.44901 -2.635,-0.7409 -4.138,-0.7409z">
          </path>
          <path d="m23.911,11.715c-0.128,-0.185 -2.251,-3.1729 -5.8199,-5.0988l2.7629,-2.7629c0.195,-0.1949 0.195,-0.5120 0,-0.707c-0.195,-0.195 -0.512,-0.195 -0.707,0l-16.9996,16.9997c-0.1949,0.195 -0.1949,0.5121 0,0.7071c0.0969,0.098 0.225,0.1469 0.35301,0.1469c0.12802,0 0.2559,-0.0489 0.354,-0.146l3.1349,-3.1349c1.5449,0.754 3.2489,1.281 5.01093,1.281c6.1609,0 11.6508,-6.404 11.8818,-6.6769c0.145,-0.1731 0.158,-0.4221 0.029,-0.6081zm-11.9108,4.285c-0.923,0 -1.762,-0.327 -2.4399,-0.853l5.58687,-5.58686c0.526,0.6779 0.853,1.5169 0.853,2.4399c0,2.2059 -1.794,3.9999 -3.9999,3.9999z">
          </path>
        </g>
      </svg>
    </template>
    <template id="tmp_eye_on_id">
      <svg class="s-eye-on s-icon">
        <g>
          <path
            fill="#2196F3"
            d="M23.9111 11.7149C23.7221 11.4409 19.1802 5 12.0003 5C5.83942 5 0.349506 11.4039 0.11851 11.6769C-0.0395033 11.8629 -0.0395033 12.1359 0.11851 12.3229C0.349506 12.5959 5.83942 18.9998 12.0003 18.9998C18.1613 18.9998 23.6512 12.5959 23.8822 12.3229C24.0272 12.1499 24.0401 11.9009 23.9111 11.7149ZM12.0003 15.9998C9.79439 15.9998 8.00042 14.2058 8.00042 11.9999C8.00042 9.79393 9.79439 7.99995 12.0003 7.99995C14.2063 7.99995 16.0003 9.79393 16.0003 11.9999C16.0003 14.2058 14.2063 15.9998 12.0003 15.9998Z"
          />
        </g>
      </svg>
    </template>

    <template id="tmp_success_id">
      <span>Your registration have been completed !</span>
      <p><a href="/signup">Go to the login page on our website.</a></p>
    </template>

    <template id="tmp_failure_id">
      <div mr-bt-05 mr-tp-05 class="s-err">Your confirmation is invalid or has expired.</div>
      <div mr-bt-05 mr-tp-05 fn-sz-2 fn-st-italic id="err_msg_id" class="s-err"></div>
      <a href="/signup">Go to the registration page on our website.</a>
    </template>


    <script type="text/javascript" language="javascript">
      function elementInput(element) {
        element?.removeAttribute("d-pristine");
        element?.setAttribute("d-dirty", "");
      }
      function elementBlur(element) {
        element?.removeAttribute("d-untouched");
        element?.setAttribute("d-touched", "");
      }
      function getHintPassword() {
        return "Use at least 6 characters, with one lowercase letter, one capital letter, a number, and a special character.";
      }
      function doInputPassword(element, isChange) {
        if (!element) { return; }
        const value = element.value;
        const attrTouched = element.hasAttribute("d-touched");
        if (isChange || attrTouched) {
          const value = element.value;
          const content = document.getElementById("content_id");
          const elementErrTxt = content?.querySelector("[id=err_hint_id]");
          let text = checkPasswd(value)
          if (!!text) {
            elementErrTxt.classList.add("s-err");
          } else {
            elementErrTxt.classList.remove("s-err");
            text = getHintPassword();
          }
          elementErrTxt.innerText = text;
        }
      }
      
      function checkPasswd(value) {
        let result = "";
        const minlength = 6;
        const maxlength = 64;

        if (!value) {
          result = "The password field is required.";
        } else if (value.length < minlength) {
          result = `The password should have ${minlength} characters or more.`
        } else if (value.length > maxlength) {
          result = `The password should be less than ${maxlength} characters.`;
        } else if (!(new RegExp("[a-z]+")).test(value)
         || !(new RegExp("[A-Z]+")).test(value)
         || !(new RegExp("[\\d]+")).test(value)) {
          result = "The password must contain: a lowercase letter, an uppercase letter and a number.";
        }
        return result;
      }

      function httpClient(apiUrl, callbackSuccess, callbackFailure, recoveryData) {
        const xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {
          if (xhr.readyState != xhr.DONE) {
            return;
          }
          if (200 <= xhr.status && xhr.status < 209) {
            callbackSuccess(xhr.responseText);
          } else {
            callbackFailure(xhr.responseText, xhr.status);
          }
        };

        xhr.open("PUT", apiUrl, true); // true for asynchronous
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(JSON.stringify(recoveryData));
      }

      function successHandler(responseText) {
        const content = document.getElementById("content_id");
        const tmpl = document.getElementById("tmp_success_id");
        const clon = tmpl?.content.cloneNode(true);
        content?.appendChild(clon);
      }

      function failureHandler(responseText, status) {
        const content = document.getElementById("content_id");
        const tmpl = document.getElementById("tmp_failure_id");
        const clon = tmpl?.content.cloneNode(true);

        const errText = clon.querySelector("[id=err_msg_id]");
        const err = JSON.parse(responseText);
        errText.innerText = (`${status} : ${err.errCode}, ${err.errMsg}`);
        content?.appendChild(clon);
      }

      function doToggleEye(elementEye, isEyeNext = null) {
        const isEyeOn = elementEye.hasAttribute("eye-on");
        const isNewEyeOn = isEyeNext != null ? isEyeNext : !isEyeOn;
        const refix = isNewEyeOn ? "on":"off";
        if (!!elementEye) {
          elementEye.removeAttribute("eye-on");
          elementEye.removeAttribute("eye-off");
          elementEye.setAttribute(`eye-${refix}`, "");
          const name = "tmp_eye_" + refix + "_id";
          const tmpl = document.getElementById(name);
          const clon = tmpl?.content.cloneNode(true);
          elementEye.children[0]?.remove();
          elementEye.appendChild(clon);
        }
        const elementPasswd = document.getElementById("field_passwd_id");
        if (!!elementPasswd) {
            elementPasswd.classList.remove("s-pass-on");
            elementPasswd.classList.remove("s-pass-off");
            elementPasswd.classList.add("s-pass-" + refix);
            elementPasswd.setAttribute("type", (isNewEyeOn ? "text":"password"));
        }
      }

      function doSubmit() {
        doToggleEye(document.getElementById("btn_eye_id"), false);
        const frm = document.getElementById("form_prm_id");
        const password = !!frm ? frm[0].value : null;
        console.log(`password: ${password}`);
        if (!!password) {
          const urlParams = new URLSearchParams(window.location.search);
          const recovery_token = urlParams.get("param")
          const url = window.location.origin + "/api/recovery/" + recovery_token;

          httpClient(url, successHandler, failureHandler, { password });
        }
      }

      // ** Data preparation **
      doToggleEye(document.getElementById("btn_eye_id"), false);

      const elementErrTxt = document.getElementById("err_hint_id");
      elementErrTxt.innerText = getHintPassword();


      /*function send() {
        var urlvariable;
        urlvariable = "text";

        var ItemJSON;
        ItemJSON = "[  {    "Id": 1,    "ProductID": "1",    "Quantity": 1,  },  {    "Id": 1,    "ProductID": "2",    "Quantity": 2,  }]";

        URL = "https://testrestapi.com/additems?var=" + urlvariable;  //Your URL

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = callbackFunction(xmlhttp);
        xmlhttp.open("POST", URL, false);
        xmlhttp.setRequestHeader("Content-Type", "application/json");
        // xmlhttp.setRequestHeader("Authorization", "Basic " + window.btoa("apiusername:apiuserpassword")); //in prod, you should encrypt user name and password and provide encrypted keys here instead 
        xmlhttp.onreadystatechange = callbackFunction(xmlhttp);
        xmlhttp.send(ItemJSON);

        alert(xmlhttp.responseText);
        document.getElementById("div").innerHTML =
          xmlhttp.statusText + ":" + xmlhttp.status + "<BR><textarea rows="100" cols="100">" + xmlhttp.responseText + "</textarea>";
      }

      function callbackFunction(xmlhttp) {
        //alert(xmlhttp.responseXML);
      }*/
    </script>


    <!--<hr />
    <div class="demo0">
      <div class="container0">
        <div *ngIf="isResponseSuccessful==true">
          <p>{{ "Your registration have been completed!" }}</p>
          < !-- Ваша регистрация завершена! -- >
          <p [innerHTML]=""confirmation.login_for_authorization" | translate: { linkToLogin: linkToLogin }"></p>
        </div>
        <div
          class="failed0"
          *ngIf="isResponseSuccessful==false"
        >
          <p>{{ "Your confirmation have been expired!" }}</p>
          < !-- Срок действия вашего подтверждения истек! -- >
        </div>
      </div>
    </div>-->

    <!-- ==V verification_code.hbs  {{#> base}} <hr/>
  <div>
    <a href="{{domain}}" target="_blank" style="font-size: 1.375em;">&#706; Verbéna &#707;</a>
    <p>Hi {{nickname}},</p>
    <p>Please confirm your account <b>registration</b></p>
    <div class="panel btn btn-primary">
      <a href="{{domain}}/confirmation/registration/{{target}}" target="_blank"
        style="text-decoration: none;color: #fff;">
        Confirm your registration
      </a>
    </div>
    <p>This link is valid for 15 minutes.</p> < !-- Эта ссылка действительна в течение 15 минут. -- >
    <p>Demo site <a href="{{domain}}" target="_blank">www.verbena</a></p>
  </div>
  ==A verification_code.hbs {{/base}} -->

    <!-- ==V password_recovery.hbs {{#> base}} <hr/>
  <div>
    <a href="{{domain}}" target="_blank" style="font-size: 1.375em;">&#706; Verbéna &#707;</a>
    <p>Hi {{nickname}},</p>
    <p>Please confirm your account <b>recovery</b></p>
    <div class="panel btn btn-primary">
      <a href="{{domain}}/confirmation/recovery/{{target}}" target="_blank"
        style="text-decoration: none;color: #fff;">
        Confirm profile recovery on the form
      </a>
    </div>
    <p>This link is valid for 10 minutes.</p> < !-- Эта ссылка действительна в течение 10 минут. -- >
    <p>Demo site <a href="{{domain}}" target="_blank">www.verbena</a></p>
  </div>
  ==A password_recovery.hbs {{/base}} -->


    <!--
<body>
    Do you want to proceed?
    <input type="button" value="Proceed" onclick="proceed();" />

    <script type="text/javascript">
        let header =
            "POST https://host.com HTTP/1.1" +
            "Host: host.com" +
            ...;

        let body = "param1=value1";

        function proceed() {
            let response = sendRequest(header, body);
            replacePageContent(response);
        }

        function sendRequest(header, body) {
            let httpRequest = new HttpRequest(header, body); // which JS library can do that?
            httpRequest.send();
        }

        function replacePageContent(response) {
            // how do I replace the page content with the response?
        }
    </script>
</body>
  -->

    <!-- ==V basic_layout.hbs -->
  </body>
</html>
