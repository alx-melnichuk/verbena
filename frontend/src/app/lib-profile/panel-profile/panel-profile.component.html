<div class="pp-panel pp-mr-hr">
  
  <div class="pp-group pp-mr-hr pp-mr-bt">

    <div class="pp-content">
      <div class="pp-title">{{ 'profile.title_profile' | translate }}</div>
    
      <form [formGroup]="formGroupProfile" class="pp-form" novalidate>

        <div class="pp-label">{{ 'profile.label_avatar' | translate }}</div>

        <div class="pp-avatar">
          <app-field-image-and-upload
            formControlName="avatar"
            [accepts]="accepts"
            [maxSize]="maxSize"
            (addFile)="updateErrMsgsProfile();addAvatarFile($event);"
            (deleteFile)="updateErrMsgsProfile();deleteAvatarFile();">
          </app-field-image-and-upload>
        </div>

        <app-uniqueness-check mr-tp-1
          #uniquenessCheckNickname="appUniquenessCheck"
          [debounceDelay]="debounceDelay"
          [checkUniquenessFn]="checkUniquenessNickname">
          <app-field-nickname wd100
            formControlName="nickname"
            [isRequired]="true"
            label="field-nickname.label"
            hint="field-nickname.nickname_hint"
            [errorMsg]="uniquenessCheckNickname.isUniquenessError ? 'Conflict.nickname_already_use' : undefined"
            (input)="updateErrMsgsProfile();
              uniquenessCheckNickname.checkParameter(cntlsProfile.nickname.value);">
          </app-field-nickname>
        </app-uniqueness-check>

        <app-uniqueness-check mr-tp-1_5
          #uniquenessCheckEmail="appUniquenessCheck"
          [debounceDelay]="debounceDelay"
          [checkUniquenessFn]="checkUniquenessEmail">
          <app-field-email wd100 class="pp-err-pd"
            formControlName="email"
            [isRequired]="true"
            label="field-email.label"
            [errorMsg]="uniquenessCheckEmail.isUniquenessError ? 'Conflict.email_already_use' : undefined"
            (input)="updateErrMsgsProfile();
              uniquenessCheckEmail.checkParameter(cntlsProfile.email.value);">
          </app-field-email>
        </app-uniqueness-check>
        
        <div mr-tp-0_5 class="pp-them-local">
          <mat-form-field
            appearance="outline"
            color="primary">
            <mat-label>{{ 'profile.label_theme' | translate }}</mat-label>
            <mat-select formControlName="theme" panelClass="ppi-option">
              <mat-select-trigger [ngClass]="(!cntlsProfile.theme.value ? 'pp-fn-it' : '')">
                {{ themeMap[cntlsProfile.theme.value || ''] }}
              </mat-select-trigger>
              <mat-option *ngFor="let themeItem of themeList"
                [ngClass]="(themeItem.value == '' ? 'pp-opt-fn-it' : '')"
                [value]="themeItem.value">
                {{ themeItem.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field
            appearance="outline"
            color="primary">
            <mat-label>{{ 'profile.label_locale' | translate }}</mat-label>
            <mat-select formControlName="locale" panelClass="ppi-option">
              <mat-select-trigger [ngClass]="(!cntlsProfile.locale.value ? 'pp-fn-it' : '')">
                {{ localeMap[cntlsProfile.locale.value || ''] }}
              </mat-select-trigger>
              <mat-option *ngFor="let localeItem of localeList"
                [ngClass]="(localeItem.value == '' ? 'pp-opt-fn-it' : '')"
                [value]="localeItem.value">
                {{ localeItem.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
  
        <app-field-descript wd100 mr-tp-0_5 class="pp-err-pd"
          formControlName="descript"
          [isRequired]="false"
          label="stream_edit.descript"
          (input)="updateErrMsgsProfile();">
        </app-field-descript>
      
        <div class="pp-actions">
          <button mat-raised-button color="primary"
            class="app-infix app-ordinary"
            [disabled]="formGroupProfile.pristine || formGroupProfile.invalid"
            (click)="saveProfile(formGroupProfile)">
            <span class="pp-actions-label">
              <i class="pp-save"></i>
              {{ 'profile.btn_save_profile' | translate }}
            </span>
          </button>
        </div>

      </form>

      <ng-container *ngFor="let errMsg of errMsgsProfile">
        <mat-error class="pp-err">{{ errMsg | translate }}</mat-error>
      </ng-container>
    </div>
  </div>

  <div class="pp-group pp-mr-hr">

    <div class="pp-content pp-mr-bt">
      <div class="pp-title">{{ 'profile.title_change_password' | translate }}</div>

      <form [formGroup]="formGroupPassword" class="pp-form" novalidate>

        <app-field-password wd100 mr-tp-0_5
          formControlName="password"
          [isRequired]="isRequiredPassword"
          label="profile.current_password"
          hint="field-password.password_hint"
          (input)="updateErrMsgsPassword();
            statePassword(cntlsPassword.password.value);
            checkPassword(formGroupPassword);">
        </app-field-password>

        <app-field-password wd100 mr-tp-1_5
          formControlName="new_password"
          [isRequired]="isRequiredPassword"
          label="profile.new_password"
          hint="field-password.password_hint"
          (input)="updateErrMsgsPassword();
            statePassword(cntlsPassword.password.value || cntlsPassword.new_password.value);
            checkPassword(formGroupPassword);">
        </app-field-password>

        <div class="pp-actions" mr-tp-1_5>
          <button mat-raised-button color="primary"
            class="app-infix app-ordinary"
            [disabled]="formGroupPassword.pristine || formGroupPassword.invalid"
            (click)="setNewPassword(formGroupPassword)">
            <span class="pp-actions-label">
              <i class="pp-save"></i>
              {{ 'profile.btn_set_password' | translate }}
            </span>
          </button>
        </div>
      </form>

      <ng-container *ngFor="let errMsg of errMsgsPassword">
        <mat-error class="pp-err">{{ errMsg | translate }}</mat-error>
      </ng-container>
    </div>

    <div class="pp-content">
      <div class="pp-title">{{ 'profile.title_delete_account' | translate }}</div>
      <div mr-tp-1_5>
        <span>{{ 'profile.note_before_deleting_account' | translate }}</span>
      </div>
      <div class="pp-actions pp-form" mr-tp-1_5>
        <button mat-raised-button color="primary"
          class="app-infix app-ordinary"
          [disabled]="isDisabledSubmit"
          (click)="removeAccount()">
          <span class="pp-actions-label">
            <i class="pp-save"></i>
            {{ 'profile.btn_delete_account' | translate }}
          </span>
        </button>
      </div>

      <ng-container *ngFor="let errMsg of errMsgsAccount">
        <mat-error class="pp-err">{{ errMsg | translate }}</mat-error>
      </ng-container>
    </div>

  </div>

  <span>&nbsp;</span>
</div>
