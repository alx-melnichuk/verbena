<div class="pc-header">
  <!-- <div class="pc-icon prc-chat-stream"></div> -->
  <div class="pc-label">{{ (title | translate) }}</div>
</div>

<div class="pc-sepr"></div>

<div class="pc-middle global-scroll" #scrollItem>
  @for (chatMsg of chatMsgs; track chatMsg.date) {    
    <div [ngClass]="['pc-item', (isSelf(chatMsg.member) ? 'pc-self' : ''), (selectedMsg==chatMsg ? 'pc-select' : ''),
     (!!nickname && nickname == chatMsg.member ? 'demo1' : '') ]"
      mouseenter9="doMouseEnter(chatMsg.date, true)"
      mouseleave9="doMouseLeave(chatMsg.date, true)"
      [matMenuTriggerFor]="isEnableMenu(chatMsg, nickname) ? menuItem : null"
      [matMenuTriggerData]="menuDataMap.get(chatMsg.date) || getMenuDataByMap(chatMsg)"
      (menuOpened)="selectedMsg=chatMsg"
      (menuClosed)="selectedMsg=null">

      <div class="pc-item-name-date">
        <div [ngClass]="['pc-item-name', (isSelf(chatMsg.member) ? 'pc-myself' : '')]">
          {{ isSelf(chatMsg.member) ? ('panel-chat.you' | translate) : memberWithZero(chatMsg.member) }}
        </div>
        <div class="pc-item-date">
          {{ chatMsg.date | dateTimeFormat:locale:formatDateTime  }}
        </div>

        <!-- @if (!isSelf(chatMsg.member)) {
        <div class="pc-date-nickname ellipsis2">{{ chatMsg.member }}</div>
        } -->
        <!-- <div class="pc-date-time"> -->
          
          <!-- {{ chatMsg.date | dateTimeFormat:locale:(isFuture ? formatDateTime : formatDate)  }} -->
          <!-- @if (!isToday(chatMsg.event)) {
          <span class="prc-text-date">{{ chatMsg.event | date:formatDateCompact }}</span>
          }
          <span class="prc-text-date"> {{ chatMsg.event | date:formatTimeShort }}</span> -->
        <!-- </div> -->
        
      </div>
      <!-- <div class="pc-item-info"> -->
        <!-- @if (!isSelf(chatMsg.member)) {
        <div class="pc-info-avatar"> -->
            <!-- <app-avatar
              [avatar]="chatMessage.avatar || null"
              [nickname]="chatMessage.nickname || null">
            </app-avatar> -->
        <!-- </div>
        } -->
        <div [ngClass]="['pc-item-msg', (isSelf(chatMsg.member) ? 'pc-myself' : '')]">
          {{ chatMsg.date }} {{ chatMsg.msg }}
          <!-- <p *ngFor="let chatMessageRow of getMessageRows(chatMsg.text)">{{ chatMessageRow }}</p> -->
        </div>
        <!-- <div *ngIf="isBannedUserById(chatMsg.member)" class="prc-banned-user">
          <div class="prc-msg-banned-orange"></div>
        </div> -->

      <!-- </div> -->
    </div>
  }
</div>

@if (isEditable && !isBlocked) {
<div class="pc-sepr"></div>

<div class="pc-footer" [formGroup]="formGroup">
  <mat-form-field [ngClass]="['pc-new-msg', (isMobile ? 'is-mobile':''), (!!modifyMsgId ? 'pc-modify-msg' : '')]"
    appearance="outline"
    color="primary"
    subscriptSizing="dynamic">
    
    <textarea matInput #messageInput #textareaElement
      class="pc-textarea global-scroll"
      formControlName="newMsg"
      autocomplete="new-password"
      autocapitalize="off"
      [attr.maxlength]="(maxLen > 0 ? maxLen + 1 : null)"
      (keydown.enter)="doKeydownEnter($event, formControl.value)"
      (keydown.escape)="doKeydownEscape()"
      cdkTextareaAutosize
      #autosize="cdkTextareaAutosize"
      [cdkAutosizeMinRows]="minRowsVal"
      [cdkAutosizeMaxRows]="2 + maxRowsVal">
    </textarea>

    @if (isMobile) {
    <button mat-icon-button matSuffix class="pc-btn-send"
      [disabled]="!formControl.value ? '' : null"
      (click)="doSendMessage(formControl.value)">
      <svg class="pc-svg-send">
        <use href="assets/icons/lib-chat/panel-chat/send-bin.svg#send-bin"></use>
      </svg>
    </button>
    }
  </mat-form-field>
</div>
}

<mat-menu #menuItem="matMenu" xPosition="before" [overlapTrigger]="true">
  <ng-template matMenuContent let-name="name" let-isEdit="isEdit" let-isRemove="isRemove">
    @if (isEdit) {
      <button mat-menu-item class="pn-menu-item" (click)="doMenuEditItem(selectedMsg)">
        <span [ngClass]="['mm-icon']"></span>
        <span class="mm-mr-lf-0_5">{{ 'panel-chat.menu.edit' | translate }}</span>
      </button>
    }
    @if (isRemove) {
      <button mat-menu-item class="pn-item-menu"  (click)="doMenuRemoveItem(selectedMsg)">
        <span class="mm-icon mm-theme"></span>
        <span class="mm-mr-lf-0_5">{{ 'panel-chat.menu.remove' | translate }}</span>
      </button>
    }
  </ng-template>
</mat-menu>
